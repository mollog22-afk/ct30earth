<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conto Termico 3.0 Advisor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .logo-text-earth { color: #000000; font-family: sans-serif; font-weight: 800; }
        .logo-text-science { color: #0088cc; font-family: sans-serif; font-weight: 400; }
        .suggestions-box { max-height: 200px; overflow-y: auto; cursor: pointer; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans">

    <header class="bg-white border-b p-4 mb-6 shadow-sm">
        <div class="max-w-5xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="flex items-baseline scale-110">
                <span class="logo-text-earth text-2xl tracking-tighter">earth</span>
                <span class="logo-text-science text-2xl tracking-tight ml-1">science</span>
            </div>
            <div class="text-center md:text-right">
                <h1 class="text-xl font-black text-gray-800 uppercase">CONTO TERMICO 3.0</h1>
                <p class="text-[9px] text-gray-500 font-bold uppercase">Sviluppato da Ing. E.Domestico (EGE)</p>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 pb-12">
        <div id="app-container" class="bg-white rounded-2xl shadow-xl border p-6 md:p-10 min-h-[450px]">
            </div>

        <div id="navigation-controls" class="mt-6 text-center hidden">
            <button onclick="renderHome()" class="px-6 py-2 bg-gray-800 text-white rounded-full hover:bg-blue-600 font-bold text-xs uppercase tracking-widest transition-all">
                ‚Üê Torna all'inizio
            </button>
        </div>
    </main>

    <script>
        // 1. DATABASE MACCHINE
        const MACCHINE = [
            { nome: "Seleziona modello...", kw: 0, scop: 0 },
            { nome: "Daikin Altherma 3 R 6kW", kw: 6, scop: 4.5 },
            { nome: "Mitsubishi Ecodan 8kW", kw: 8, scop: 4.3 },
            { nome: "Rossato Air Inverter 10kW", kw: 10, scop: 4.1 }
        ];

        // 2. ORE ZONA CLIMATICA
        const ORE_ZONA = { 'A': 600, 'B': 850, 'C': 1100, 'D': 1400, 'E': 1700, 'F': 1800 };

        // 3. DATABASE COMUNI (Estratto dal tuo elenco)
        const DB_RAW = [
            ";TO;Agli ;315;2617;E", ";TO;Airasca;257;2781;E", ";TO;Ala di Stura;1080;3974;F", 
            ";TO;Albiano d'Ivrea;230;2706;E", ";TO;Alice Superiore;610;3146;F", ";TO;Almese;364;2900;E",
            ";TO;Alpette;957;3789;F", ";TO;Alpignano;314;2825;E", ";TO;Andezeno;306;2813;E",
            ";TO;Andrate;836;3495;F", ";TO;Angrogna;782;3527;F", ";TO;Arignano;321;2835;E",
            ";TO;Avigliana;383;2928;E", ";TO;Azeglio;260;2748;E", ";TO;Bairo;360;2684;E",
            ";TO;Balangero;440;3085;F", ";TO;Beinasco;265;2591;E", ";TO;Carmagnola;240;2714;E",
            ";TO;Chieri;283;2778;E", ";TO;Ivrea;253;2737;E", ";TO;Pinerolo;376;2815;E",
            ";TO;Torino;239;2617;E", ";TO;Susa;503;3108;F", ";TO;Sestriere;2035;5165;F"
        ];

        // Pulizia dati comuni
        const COMUNI_CLEAN = DB_RAW.map(riga => {
            const p = riga.split(';');
            if (p.length >= 6) return { c: p[2].trim(), pr: p[1], z: p[5].trim() };
            return null;
        }).filter(i => i);

        // FUNZIONE INIZIALE
        function renderHome() {
            document.getElementById('navigation-controls').classList.add('hidden');
            document.getElementById('app-container').innerHTML = `
                <div class="text-center mb-10">
                    <h2 class="text-2xl font-black text-gray-700 uppercase italic">Seleziona Soggetto</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <button onclick="selectSoggetto('Privato')" class="p-8 border-2 rounded-2xl hover:border-blue-500 bg-white shadow-sm transition-all text-center group">
                        <div class="text-4xl mb-2">üè†</div>
                        <span class="font-bold uppercase text-gray-800">Privato</span>
                    </button>
                    <button onclick="selectSoggetto('Impresa')" class="p-8 border-2 rounded-2xl hover:border-blue-500 bg-white shadow-sm transition-all text-center group">
                        <div class="text-4xl mb-2">üè¢</div>
                        <span class="font-bold uppercase text-gray-800">Impresa</span>
                    </button>
                    <button onclick="selectSoggetto('PA')" class="p-8 border-2 rounded-2xl hover:border-blue-500 bg-white shadow-sm transition-all text-center group">
                        <div class="text-4xl mb-2">üèõÔ∏è</div>
                        <span class="font-bold uppercase text-gray-800">P.A.</span>
                    </button>
                </div>`;
        }

        // MASCHERA DI CALCOLO
        function selectSoggetto(tipo) {
            document.getElementById('navigation-controls').classList.remove('hidden');
            document.getElementById('app-container').innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-xl font-black border-b pb-4 uppercase italic text-blue-600">Intervento PDC (${tipo})</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="relative">
                            <label class="block text-[10px] font-black text-blue-500 uppercase mb-1">üìç Comune</label>
                            <input type="text" id="inpComune" onkeyup="filtra(this.value)" class="w-full p-3 border-2 rounded-xl font-bold" placeholder="Cerca...">
                            <div id="sugg" class="absolute z-50 w-full bg-white shadow-2xl rounded-b-xl hidden border"></div>
                        </div>
                        <div>
                            <label class="block text-[10px] font-black text-orange-500 uppercase mb-1">‚òÄÔ∏è Zona Climatica</label>
                            <input type="text" id="mostraZona" class="w-full p-3 border-2 rounded-xl font-bold bg-orange-50 text-orange-700" readonly value="-">
                        </div>
                    </div>

                    <div>
                        <label class="block text-[10px] font-black text-blue-500 uppercase mb-1">‚öôÔ∏è Modello Pompa di Calore</label>
                        <select onchange="aggiornaMacchina(this.value)" class="w-full p-3 border-2 rounded-xl font-bold bg-white">
                            ${MACCHINE.map((m, i) => `<option value="${i}">${m.nome}</option>`).join('')}
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <input type="number" id="pmIII" placeholder="kW" class="p-3 border-2 rounded-xl font-bold">
                        <input type="number" id="scopIII" placeholder="SCOP" class="p-3 border-2 rounded-xl font-bold">
                    </div>

                    <input type="hidden" id="zonaVal" value="0">
                    <button onclick="calcola()" class="w-full bg-blue-600 text-white font-black py-4 rounded-xl shadow-lg uppercase">Calcola Incentivo</button>

                    <div id="res-box" class="hidden p-6 bg-blue-900 text-white rounded-2xl text-center">
                        <p class="text-xs uppercase opacity-60">Incentivo Totale Estimato</p>
                        <h2 id="risultato" class="text-4xl font-black">‚Ç¨ 0,00</h2>
                    </div>
                </div>`;
        }

        // LOGICA FUNZIONALE
        function filtra(t) {
            const s = document.getElementById('sugg');
            if(t.length < 2) { s.classList.add('hidden'); return; }
            const m = COMUNI_CLEAN.filter(i => i.c.toLowerCase().includes(t.toLowerCase())).slice(0,5);
            s.innerHTML = m.map(i => `<div class="p-3 hover:bg-blue-50 cursor-pointer font-bold border-b text-sm" onclick="setComune('${i.c.replace(/'/g, "\\'")}', '${i.z}')">${i.c} (${i.pr})</div>`).join('');
            s.classList.remove('hidden');
        }

        function setComune(n, z) {
            document.getElementById('inpComune').value = n;
            document.getElementById('sugg').classList.add('hidden');
            document.getElementById('mostraZona').value = "Zona " + z;
            document.getElementById('zonaVal').value = ORE_ZONA[z] || 0;
        }

        function aggiornaMacchina(idx) {
            const m = MACCHINE[idx];
            if(m.kw > 0) {
                document.getElementById('pmIII').value = m.kw;
                document.getElementById('scopIII').value = m.scop;
            }
        }

        function calcola() {
            const p = parseFloat(document.getElementById('pmIII').value) || 0;
            const h = parseFloat(document.getElementById('zonaVal').value) || 0;
            const s = parseFloat(document.getElementById('scopIII').value) || 0;
            if(!h) { alert("Seleziona un comune!"); return; }
            
            const inc = 0.11 * p * h * (1 - (1/s)) * 2;
            document.getElementById('res-box').classList.remove('hidden');
            document.getElementById('risultato').innerText = "‚Ç¨ " + inc.toLocaleString('it-IT', {minimumFractionDigits:2, maximumFractionDigits:2});
        }

        window.onload = renderHome;
    </script>
</body>
</html>
